[gd_scene load_steps=2 format=3 uid="uid://bak8ltrhbmlv5"]

[sub_resource type="GDScript" id="GDScript_0eugj"]
script/source = "@tool
extends CSGBox3D

@export var num_stairs : int = 10

var _cur_num_stairs = -1
var _cur_size : Vector3

func make_stairs():
	#if not Engine.is_editor_hint():
		#return
	#
	num_stairs = clampi(num_stairs, 0, 999)

	var stairs_poly = $StairsSubtractCSG#add_fresh_stairs_csg_poly()
	
	var point_arr : PackedVector2Array = PackedVector2Array()
	var step_height = self.size.y / num_stairs
	var step_width = self.size.x / num_stairs
	
	if num_stairs == 0:
		# For 0 stairs make a ramp
		point_arr.append(Vector2(self.size.x, self.size.y))
		point_arr.append(Vector2(0, self.size.y))
		point_arr.append(Vector2(0, 0))
	else:
		# Creating the points for the stairs polygon
		for i in range(num_stairs - 1):
			point_arr.append(Vector2(i * step_width, (i + 1) * step_height))
			if i < num_stairs:
				point_arr.append(Vector2((i + 1) * step_width, (i + 1) * step_height))

		# Closing the polygon by adding the last two points
		point_arr.append(Vector2(self.size.x - step_width, self.size.y))
		point_arr.append(Vector2(0, self.size.y))
	
	stairs_poly.polygon = point_arr
		
	stairs_poly.depth = self.size.z
	
	stairs_poly.position.z = self.size.z / 2.0
	stairs_poly.position.y = -self.size.y / 2.0
	stairs_poly.position.x = -self.size.x / 2.0

	_cur_num_stairs = num_stairs
	_cur_size = self.size

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(_delta):
	if _cur_num_stairs != num_stairs or _cur_size != self.size:
		make_stairs()
"

[node name="CSGStairMaker3D" type="CSGBox3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.525532, 0)
script = SubResource("GDScript_0eugj")
num_stairs = 4

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.163925, 2.02149, -5.41886)
size = Vector3(0.864136, 5.11536, 8.50867)

[node name="CSGBox3D2" type="CSGPolygon3D" parent="."]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -0.362595, -0.251695, -9.70928)
operation = 2
polygon = PackedVector2Array(0, 0, 0.00532818, 4.87228, 8.7634, 4.85194, 0.00159645, -0.319012)

[node name="CSGBox3D3" type="CSGBox3D" parent="."]
transform = Transform3D(-1, 0, 0.000558527, 0, 1, 0, -0.000558527, 0, -1, 0.178752, 2.02149, 6.13876)
size = Vector3(0.937012, 5.11536, 8.50867)

[node name="CSGBox3D4" type="CSGPolygon3D" parent="."]
transform = Transform3D(0.000558571, 0, 1, 0, 1, 0, -1, 0, 0.000558571, 0.661332, -0.251695, 10.4294)
operation = 2
polygon = PackedVector2Array(0, 0, 0.00532818, 4.87228, 8.7634, 4.85194, 0.00159645, -0.319012)
